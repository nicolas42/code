<!DOCTYPE html>
<style> * { margin: 0; padding: 0; box-sizing: border-box; } </style>

<canvas id="spiral">click me</canvas><br>
<audio controls>
    <source src="12monkeys.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
</audio><br>
<input id="show_angle" type="checkbox"><span>show angle?</span></input><br>
<input  id="angle" style="width:100%" type="range" min="1" max="10000" value="5000"><br>
<input  id="scale" style="width:100%" type="range" min="1" max="200" value="100"><br>
<input  id="max_distance" style="width:100%" type="range" min="1" max="1000" value="500"><br>
<input  id="line_width" style="width:100%" type="range" min="1" max="10" value="1"><br>
<pre></pre>



<script>


function html(query_selector)
{
    return document.querySelector(query_selector);
}

function draw_spiral(canvas, pattern)
{
    let ctx = canvas.getContext('2d');
    // reset all transforms
    ctx.setTransform();


    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.translate(canvas.width / 2, canvas.height / 2);
    ctx.scale(pattern.scale, pattern.scale);


    ctx.strokeStyle = pattern.color;
    ctx.lineWidth = pattern.line_width;

    for (let stroke_length = 0; stroke_length < pattern.max_distance; stroke_length += 1) {

        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(0, stroke_length);
        ctx.stroke();

        ctx.translate(0, stroke_length);
        ctx.rotate(pattern.angle);
    }
}

function make_random_color()
{
    return "#" + Math.floor(Math.random() * 16777216).toString(16);
}


// ============== Globals ==================
var canvas = html('#spiral');
canvas.width = window.innerWidth - 20;
canvas.height = window.innerHeight;

var pattern = { 
    angle: Math.random() * 2 * Math.PI,
    color: make_random_color(),
    max_distance: 500,
    scale: 1,
    line_width: 1,
    // step: 1
}
draw_spiral(canvas, pattern);


html("#angle").oninput = function () {
    pattern.angle = this.value / 10000 * 2 * Math.PI;
}

html("#max_distance").oninput = function () {
    pattern.max_distance = this.value;
}

html("#scale").oninput = function () {
    pattern.scale = this.value / 100;
}

html("#line_width").oninput = function () {
    pattern.line_width = this.value;
}


var timer_id = 0;
var started_music = false;
function draw_rotating_spiral()
{
    pattern.angle = Math.random() * 2 * Math.PI;
    pattern.color = make_random_color();
    // console.log(pattern);

    clearInterval(timer_id);
    timer_id = setInterval(function(){
        pattern.angle += 0.00001
        // pattern.color = make_random_color();
        draw_spiral(canvas, pattern);

        if ( html('input#show_angle').checked ) {
            var the_text = JSON.stringify(pattern.angle)
            var ctx = canvas.getContext("2d");
            ctx.setTransform(); // reset all transforms
            ctx.fillStyle = "grey";
            ctx.font = "20px Verdana";
            ctx.fillText(the_text, 20 , canvas.height - 20);
        }

    }, 10); 


    var pre = html('pre');
    pre.innerText += JSON.stringify(pattern) + '\n';


    var audio = html('audio')
    if ( audio.paused && !started_music ) { audio.play(); started_music = true; }
}

canvas.addEventListener('click', draw_rotating_spiral);




</script>

</html>